/*
 * MAL[MartinAlexandreLaurie]Ware program for project Gutenberg
 * choose a text
 * => add a style
 * => print!
 * */

source = "../examples/alice.htm"; // http://www.gutenberg.org/files/11/11-h/11-h.htm
//source = "http://www.gutenberg.org/files/31704/31704-h/31704-h.htm";
//source = "http://leyokki.org";

var result = '';
var nodeValues = [];

function loadDiv(source)
{
	// loading webpage from source URL
	$.get('php/grabber.php?url='+source,function(data){
		delHeaders(data);
	});
}

function delHeaders(data){
	var $page = $("#page"),
	isHead = false,
	html = $.parseHTML(data),
	nodeNames = [],
	scrolling = "",

	/* TO ADD SOME DAY */
	// compteur pour le nombre de paragraphes
	// idée: si nb_p est un nombre premier, ajoute une classe
	nb_p = 0;

	// parses elements of the page
	$.each(html,function(i,el){
		//scrolling pour jeter un oeil aux balises
		scrolling += el.nodeName+"\n";

		// It parses and keeps only h1, h2, h3, h4 and <p>
		// note: function deleted : prime
		if (el.nodeName == "H1") {
			nodeNames[i] = "<h1>"+el.innerHTML+"</h1>";
		} else if (el.nodeName == "H2") {
			nodeNames[i] = "<h2>"+el.innerHTML+"</h2>";
		} else if (el.nodeName == "H3") {
			nodeNames[i] = "<h3>"+el.innerHTML+"</h3>";
		} else if (el.nodeName == "H4") {
			nodeNames[i] = "<h4>"+el.innerHTML+"</h4>";
		} else if (el.nodeName == "#text" || el.nodeName == "PRE" || el.nodeName == "TITLE" || el.nodeName == "#comment") {
			var haveaniceday = true;
		} else {
			nodeNames[i] = "<p>"+el.innerHTML+"</p>";
		}
	});

	// cleaning nodes
	nodeNames.forEach(function(line){
		cleaningLine(line);
	});

	// print the results
	$page.append(nodeNames.join(""))
		.appendTo($page);
	//console.log(scrolling);
}

// delete blank <p>
function cleaningLine(line){
	shortline = "";
	// check line is a paragraph
	if (line[1] == "p") {
	} else {
		console.log("not a paragraph");
		shortline = line;
		$("#log").append(shortline);
	}
}

// function to test if n is a prime number
// cf. http://www.javascripter.net/faq/numberisprime.htm
function isPrime3(n) {
	 if (isNaN(n) || !isFinite(n) || n%1 || n<2) return false; 
	  if (n%2==0) return (n==2);
	   if (n%3==0) return (n==3);
	    var m=Math.sqrt(n);
	     for (var i=5;i<=m;i+=6) {
		       if (n%i==0)     return false;
		         if (n%(i+2)==0) return false;
			  }
	      return true;
}

loadDiv(source);

// OLD NOTES

// conserver les <ol> pour garder les styles ? = $("<ol></ol>")
// weird stuff: anchors still works (for titles)
